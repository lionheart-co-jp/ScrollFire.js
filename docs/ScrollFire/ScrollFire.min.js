(function(d,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(d=typeof globalThis<"u"?globalThis:d||self,d.ScrollFire=o())})(this,function(){"use strict";var F=Object.defineProperty;var T=(d,o,u)=>o in d?F(d,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[o]=u;var c=(d,o,u)=>(T(d,typeof o!="symbol"?o+"":o,u),u);const d="",o=l=>l.each!==void 0,u=l=>l.length!==void 0,m=(l,e,t=null)=>{if(!(e in l.dataset))return t;const r=parseFloat(l.dataset[e]||"");return isNaN(r)?t:r},D={root:null,ratio:m(document.body,"scrollFireRatio",50),debugThresholdView:document.body.dataset.scrollFireDebugThresholdView!==void 0,debugThresholdViewColor:"rgba(255, 0, 0, 0.5)",debugDummyElementView:document.body.dataset.scrollFireDebugDummyElementView!==void 0,debugDummyElementViewColor:"rgba(0, 0, 255, 0.5)"};class w{constructor(e,t,r,s={}){c(this,"target");c(this,"htmlElementList");c(this,"rootElement");c(this,"enterCallback");c(this,"leaveCallback");c(this,"options");c(this,"intersectionOption");c(this,"intersectionObserver");this.target=e,this.enterCallback=t,this.leaveCallback=r,this.options={...D,...s},this.rootElement=this.options.root||document.body,this.intersectionOption={threshold:[0,.5,1],root:this.options.root,rootMargin:`0px 0px -${100-this.options.ratio}% 0px`},this.htmlElementList=(()=>o(this.target)?this.target.toArray():u(this.target)?Array.from(this.target):[this.target])(),this.prepareDummyElement(),this.intersectionObserver=this.prepareObserverInstance(),this.prepareDebugView()}prepareDummyElement(){this.htmlElementList.forEach(e=>{const t=this.createDummyElement(e);this.rootElement.appendChild(t)})}createDummyElement(e){const t=self.crypto.randomUUID(),r=document.createElement("span");return r.dataset.scrollFireDummy=t,e.dataset.scrollFireTarget=t,this.options.debugDummyElementView&&(r.dataset.scrollFireDummyView="is-acitve",r.style.borderTopColor=this.options.debugDummyElementViewColor),r}resetDummyElementPosition(){this.htmlElementList.forEach(e=>{const t=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);if(!t)return;t.style.top="0px";const r=this.adjustedBoundingRect(t),s=this.adjustedBoundingRect(e);t.style.top=`${s.top-r.top}px`})}prepareObserverInstance(){const e=o(this.target);return new IntersectionObserver(t=>{const r=this.getThresholdTop(this.options.ratio);t.map(s=>{const i=s.target,n=this.rootElement.querySelector(`[data-scroll-fire-target="${i.dataset.scrollFireDummy}"]`);n&&(s.isIntersecting||s.boundingClientRect.bottom<=r?typeof this.enterCallback=="function"&&this.enterCallback(e?jQuery(n):n):!s.isIntersecting&&s.boundingClientRect.bottom>r&&typeof this.leaveCallback=="function"&&this.leaveCallback(e?jQuery(n):n))})},this.intersectionOption)}prepareDebugView(){if(!this.options.debugThresholdView)return;const e=document.createElement("span");e.dataset.scrollFireThresholdDemo="is-acitve",e.style.top=`${this.options.ratio}%`,e.style.borderTopColor=this.options.debugThresholdViewColor,document.body.appendChild(e)}observe(){this.htmlElementList.forEach(e=>{const t=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);t&&this.intersectionObserver.observe(t)})}unobserve(){this.htmlElementList.forEach(e=>{this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`)&&this.intersectionObserver.unobserve(e)})}getThresholdTop(e){return window.innerHeight*(e/100)}adjustedBoundingRect(e){var t=e.getBoundingClientRect(),r=getComputedStyle(e),s=r.transform;if(s){var i,n,h,f;if(s.startsWith("matrix3d(")){var a=s.slice(9,-1).split(/, /);i=+a[0],n=+a[5],h=+a[12],f=+a[13]}else if(s.startsWith("matrix(")){var a=s.slice(7,-1).split(/, /);i=+a[0],n=+a[3],h=+a[4],f=+a[5]}else return t;var g=r.transformOrigin,p=t.x-h-(1-i)*parseFloat(g),b=t.y-f-(1-n)*parseFloat(g.slice(g.indexOf(" ")+1)),v=i?t.width/i:e.offsetWidth,E=n?t.height/n:e.offsetHeight;return{x:p,y:b,width:v,height:E,top:b,right:p+v,bottom:b+E,left:p}}else return t}}class y{constructor(){c(this,"trigger",[]);c(this,"_flag",!1);c(this,"_listner",this.onResize.bind(this))}start(){return this._flag?this:(this._flag=!0,this.observe(),this)}stop(){return this._flag?(this._flag=!1,this.unobserve(),this):this}addTrigger(e,t,r,s={}){return this.trigger.push(new w(e,t,r,s)),this}observe(){this.trigger.forEach(e=>e.observe()),window.addEventListener("resize",this._listner),window.addEventListener("load",this._listner),this._listner()}unobserve(){this.trigger.forEach(e=>e.unobserve()),window.removeEventListener("resize",this._listner),window.removeEventListener("load",this._listner)}onResize(){this.trigger.forEach(e=>e.resetDummyElementPosition())}}return window.addEventListener("DOMContentLoaded",()=>{const l=document.querySelectorAll("[data-scroll-fire]");if(!l.length)return;const e=m(document.body,"scrollFireDelay"),t=m(document.body,"scrollFireDuration"),r=m(document.body,"scrollFireScale"),s=document.body.dataset.scrollFireDistance||null;l.forEach(i=>{const n=m(i,"scrollFireDelay",e);n&&i.style.setProperty("--scroll-fire-delay",`${n}ms`);const h=m(i,"scrollFireDuration",t);h&&i.style.setProperty("--scroll-fire-duration",`${h}ms`);const f=i.dataset.scrollFireDistance||s;f&&i.style.setProperty("--scroll-fire-distance",f);const a=m(i,"scrollFireScale",r);a&&i.style.setProperty("--scroll-fire-scale",a.toString())}),new y().addTrigger(l,i=>i.dataset.scrollFireAnimate="active",i=>{if(!("scrollFireNotReverse"in document.body.dataset||"scrollFireNotReverse"in i.dataset))return delete i.dataset.scrollFireAnimate},{}).start()}),y});
