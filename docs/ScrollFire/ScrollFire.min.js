(function(u,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(u=typeof globalThis<"u"?globalThis:u||self,u.ScrollFire=a())})(this,function(){"use strict";var S=Object.defineProperty;var I=(u,a,c)=>a in u?S(u,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):u[a]=c;var d=(u,a,c)=>(I(u,typeof a!="symbol"?a+"":a,c),c);const u=t=>t.each!==void 0,a=t=>t.length!==void 0,c=(t,e,r=null)=>{if(!t||!(e in t.dataset))return r;const i=parseFloat(t.dataset[e]||"");return isNaN(i)?r:i};let g;const F=new Uint8Array(16);function R(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(F)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function T(t,e=0){return o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]}const f={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function C(t,e,r){if(f.randomUUID&&!e&&!t)return f.randomUUID();t=t||{};const i=t.random||(t.rng||R)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){r=r||0;for(let s=0;s<16;++s)e[r+s]=i[s];return e}return T(i)}const O=()=>({root:null,ratio:c(document.body,"scrollFireRatio",50),debugThresholdView:document.body.dataset.scrollFireDebugThresholdView!==void 0,debugThresholdViewColor:"rgba(255, 0, 0, 0.5)",debugDummyElementView:document.body.dataset.scrollFireDebugDummyElementView!==void 0,debugDummyElementViewColor:"rgba(0, 0, 255, 0.5)"});class V{constructor(e,r,i,s={}){d(this,"target");d(this,"htmlElementList");d(this,"rootElement");d(this,"enterCallback");d(this,"leaveCallback");d(this,"options");d(this,"intersectionOption");d(this,"intersectionObserver");d(this,"resizeObserver");this.target=e,this.enterCallback=r,this.leaveCallback=i,this.options={...O(),...s},this.rootElement=this.options.root||document.body,this.intersectionOption={threshold:[0,.5,1],root:this.options.root,rootMargin:"0px 0px -50% 0px"},this.htmlElementList=u(this.target)?this.target.toArray():a(this.target)?Array.from(this.target):[this.target],this.prepareDummyElement(),this.intersectionObserver=this.prepareIntersectionObserverInstance(),this.resizeObserver=this.prepareResizeOvserverInstance(),this.prepareDebugView()}prepareDummyElement(){this.htmlElementList.forEach(e=>{const r=this.createDummyElement(e);this.rootElement.appendChild(r)})}createDummyElement(e){const r=C(),i=document.createElement("span");return i.dataset.scrollFireDummy=r,e.dataset.scrollFireTarget=r,this.options.debugDummyElementView&&(i.dataset.scrollFireDummyView="is-acitve",i.style.borderTopColor=this.options.debugDummyElementViewColor),i}resetDummyElementPosition(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);if(!r)return;r.style.top="0px";const i=this.adjustedBoundingRect(r),s=this.adjustedBoundingRect(e);r.style.top=`${s.top-i.top}px`,r.style.setProperty("--scroll-fire-ratio-top",`${window.innerHeight*(this.options.ratio-50)/100}px`)})}prepareIntersectionObserverInstance(){const e=u(this.target);return new IntersectionObserver(r=>{const i=this.getThresholdTop(this.options.ratio);r.map(s=>{const n=s.target,l=this.rootElement.querySelector(`[data-scroll-fire-target="${n.dataset.scrollFireDummy}"]`);l&&(s.isIntersecting||s.boundingClientRect.bottom<=i?typeof this.enterCallback=="function"&&this.enterCallback(e?jQuery(l):l):!s.isIntersecting&&s.boundingClientRect.bottom>i&&typeof this.leaveCallback=="function"&&this.leaveCallback(e?jQuery(l):l))})},this.intersectionOption)}prepareResizeOvserverInstance(){return new ResizeObserver(()=>{this.resetDummyElementPosition()})}prepareDebugView(){if(!this.options.debugThresholdView)return;const e=document.createElement("span");e.dataset.scrollFireThresholdDemo="is-acitve",e.style.top=`${this.options.ratio}%`,e.style.borderTopColor=this.options.debugThresholdViewColor,document.body.appendChild(e)}observe(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);r&&(this.intersectionObserver.observe(r),this.resizeObserver.observe(r))})}unobserve(){this.htmlElementList.forEach(e=>{this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`)&&(this.intersectionObserver.unobserve(e),this.resizeObserver.unobserve(e))})}getThresholdTop(e){return window.innerHeight*(e/100)}adjustedBoundingRect(e){var r=e.getBoundingClientRect(),i=getComputedStyle(e),s=i.transform;if(s){var n,l,h,p;if(s.startsWith("matrix3d(")){var m=s.slice(9,-1).split(/, /);n=+m[0],l=+m[5],h=+m[12],p=+m[13]}else if(s.startsWith("matrix(")){var m=s.slice(7,-1).split(/, /);n=+m[0],l=+m[3],h=+m[4],p=+m[5]}else return r;var y=i.transformOrigin,v=r.x-h-(1-n)*parseFloat(y),b=r.y-p-(1-l)*parseFloat(y.slice(y.indexOf(" ")+1)),w=n?r.width/n:e.offsetWidth,D=l?r.height/l:e.offsetHeight;return{x:v,y:b,width:w,height:D,top:b,right:v+w,bottom:b+D,left:v}}else return r}}const z=new CustomEvent("scrollFireResizeEvent");class E{constructor(){d(this,"trigger",[]);d(this,"_flag",!1);d(this,"_listner",this.onResize.bind(this))}start(){return this._flag?this:(this._flag=!0,this.observe(),this)}stop(){return this._flag?(this._flag=!1,this.unobserve(),this):this}addTrigger(e,r,i,s={}){return this.trigger.push(new V(e,r,i,s)),this}observe(){this.trigger.forEach(e=>e.observe()),window.addEventListener("resize",this._listner),window.addEventListener("load",this._listner),window.addEventListener("scrollFireResizeEvent",this._listner),this._listner()}unobserve(){this.trigger.forEach(e=>e.unobserve()),window.removeEventListener("resize",this._listner),window.removeEventListener("load",this._listner),window.removeEventListener("scrollFireResizeEvent",this._listner)}onResize(){this.trigger.forEach(e=>e.resetDummyElementPosition())}static forceResize(){window.dispatchEvent(z)}}return window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("[data-scroll-fire]");if(!t.length)return;const e=c(document.body,"scrollFireDelay"),r=c(document.body,"scrollFireDuration"),i=c(document.body,"scrollFireScale"),s=document.body.dataset.scrollFireDistance||null;t.forEach(n=>{const l=c(n,"scrollFireDelay",e);l&&n.style.setProperty("--scroll-fire-delay",`${l}ms`);const h=c(n,"scrollFireDuration",r);h&&n.style.setProperty("--scroll-fire-duration",`${h}ms`);const p=n.dataset.scrollFireDistance||s;p&&n.style.setProperty("--scroll-fire-distance",p);const m=c(n,"scrollFireScale",i);m&&n.style.setProperty("--scroll-fire-scale",m.toString())}),new E().addTrigger(t,n=>{if(n)return n.dataset.scrollFireAnimate="active"},n=>{if(!(document.body.dataset&&"scrollFireNotReverse"in document.body.dataset||n&&"scrollFireNotReverse"in n.dataset))return delete n.dataset.scrollFireAnimate},{}).start()}),E});
