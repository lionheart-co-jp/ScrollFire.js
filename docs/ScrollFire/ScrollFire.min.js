(function(u,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(u=typeof globalThis<"u"?globalThis:u||self,u.ScrollFire=l())})(this,function(){"use strict";var O=Object.defineProperty;var U=(u,l,m)=>l in u?O(u,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[l]=m;var c=(u,l,m)=>(U(u,typeof l!="symbol"?l+"":l,m),m);const u="",l=t=>t.each!==void 0,m=t=>t.length!==void 0,h=(t,e,r=null)=>{if(!(e in t.dataset))return r;const i=parseFloat(t.dataset[e]||"");return isNaN(i)?r:i};let y;const T=new Uint8Array(16);function C(){if(!y&&(y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(T)}const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));function V(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}const E={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function S(t,e,r){if(E.randomUUID&&!e&&!t)return E.randomUUID();t=t||{};const i=t.random||(t.rng||C)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=i[o];return e}return V(i)}const R={root:null,ratio:h(document.body,"scrollFireRatio",50),debugThresholdView:document.body.dataset.scrollFireDebugThresholdView!==void 0,debugThresholdViewColor:"rgba(255, 0, 0, 0.5)",debugDummyElementView:document.body.dataset.scrollFireDebugDummyElementView!==void 0,debugDummyElementViewColor:"rgba(0, 0, 255, 0.5)"};class L{constructor(e,r,i,o={}){c(this,"target");c(this,"htmlElementList");c(this,"rootElement");c(this,"enterCallback");c(this,"leaveCallback");c(this,"options");c(this,"intersectionOption");c(this,"intersectionObserver");this.target=e,this.enterCallback=r,this.leaveCallback=i,this.options={...R,...o},this.rootElement=this.options.root||document.body,this.intersectionOption={threshold:[0,.5,1],root:this.options.root,rootMargin:`0px 0px -${100-this.options.ratio}% 0px`},this.htmlElementList=(()=>l(this.target)?this.target.toArray():m(this.target)?Array.from(this.target):[this.target])(),this.prepareDummyElement(),this.intersectionObserver=this.prepareObserverInstance(),this.prepareDebugView()}prepareDummyElement(){this.htmlElementList.forEach(e=>{const r=this.createDummyElement(e);this.rootElement.appendChild(r)})}createDummyElement(e){const r=S(),i=document.createElement("span");return i.dataset.scrollFireDummy=r,e.dataset.scrollFireTarget=r,this.options.debugDummyElementView&&(i.dataset.scrollFireDummyView="is-acitve",i.style.borderTopColor=this.options.debugDummyElementViewColor),i}resetDummyElementPosition(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);if(!r)return;r.style.top="0px";const i=this.adjustedBoundingRect(r),o=this.adjustedBoundingRect(e);r.style.top=`${o.top-i.top}px`})}prepareObserverInstance(){const e=l(this.target);return new IntersectionObserver(r=>{const i=this.getThresholdTop(this.options.ratio);r.map(o=>{const s=o.target,a=this.rootElement.querySelector(`[data-scroll-fire-target="${s.dataset.scrollFireDummy}"]`);a&&(o.isIntersecting||o.boundingClientRect.bottom<=i?typeof this.enterCallback=="function"&&this.enterCallback(e?jQuery(a):a):!o.isIntersecting&&o.boundingClientRect.bottom>i&&typeof this.leaveCallback=="function"&&this.leaveCallback(e?jQuery(a):a))})},this.intersectionOption)}prepareDebugView(){if(!this.options.debugThresholdView)return;const e=document.createElement("span");e.dataset.scrollFireThresholdDemo="is-acitve",e.style.top=`${this.options.ratio}%`,e.style.borderTopColor=this.options.debugThresholdViewColor,document.body.appendChild(e)}observe(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);r&&this.intersectionObserver.observe(r)})}unobserve(){this.htmlElementList.forEach(e=>{this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`)&&this.intersectionObserver.unobserve(e)})}getThresholdTop(e){return window.innerHeight*(e/100)}adjustedBoundingRect(e){var r=e.getBoundingClientRect(),i=getComputedStyle(e),o=i.transform;if(o){var s,a,g,p;if(o.startsWith("matrix3d(")){var d=o.slice(9,-1).split(/, /);s=+d[0],a=+d[5],g=+d[12],p=+d[13]}else if(o.startsWith("matrix(")){var d=o.slice(7,-1).split(/, /);s=+d[0],a=+d[3],g=+d[4],p=+d[5]}else return r;var b=i.transformOrigin,f=r.x-g-(1-s)*parseFloat(b),v=r.y-p-(1-a)*parseFloat(b.slice(b.indexOf(" ")+1)),w=s?r.width/s:e.offsetWidth,F=a?r.height/a:e.offsetHeight;return{x:f,y:v,width:w,height:F,top:v,right:f+w,bottom:v+F,left:f}}else return r}}class D{constructor(){c(this,"trigger",[]);c(this,"_flag",!1);c(this,"_listner",this.onResize.bind(this))}start(){return this._flag?this:(this._flag=!0,this.observe(),this)}stop(){return this._flag?(this._flag=!1,this.unobserve(),this):this}addTrigger(e,r,i,o={}){return this.trigger.push(new L(e,r,i,o)),this}observe(){this.trigger.forEach(e=>e.observe()),window.addEventListener("resize",this._listner),window.addEventListener("load",this._listner),this._listner()}unobserve(){this.trigger.forEach(e=>e.unobserve()),window.removeEventListener("resize",this._listner),window.removeEventListener("load",this._listner)}onResize(){this.trigger.forEach(e=>e.resetDummyElementPosition())}}return window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("[data-scroll-fire]");if(!t.length)return;const e=h(document.body,"scrollFireDelay"),r=h(document.body,"scrollFireDuration"),i=h(document.body,"scrollFireScale"),o=document.body.dataset.scrollFireDistance||null;t.forEach(s=>{const a=h(s,"scrollFireDelay",e);a&&s.style.setProperty("--scroll-fire-delay",`${a}ms`);const g=h(s,"scrollFireDuration",r);g&&s.style.setProperty("--scroll-fire-duration",`${g}ms`);const p=s.dataset.scrollFireDistance||o;p&&s.style.setProperty("--scroll-fire-distance",p);const d=h(s,"scrollFireScale",i);d&&s.style.setProperty("--scroll-fire-scale",d.toString())}),new D().addTrigger(t,s=>s.dataset.scrollFireAnimate="active",s=>{if(!("scrollFireNotReverse"in document.body.dataset||"scrollFireNotReverse"in s.dataset))return delete s.dataset.scrollFireAnimate},{}).start()}),D});
