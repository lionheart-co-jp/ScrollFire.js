(function(u,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(u=typeof globalThis<"u"?globalThis:u||self,u.ScrollFire=l())})(this,function(){"use strict";var S=Object.defineProperty;var I=(u,l,m)=>l in u?S(u,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[l]=m;var c=(u,l,m)=>(I(u,typeof l!="symbol"?l+"":l,m),m);const u="",l=t=>t.each!==void 0,m=t=>t.length!==void 0,h=(t,e,r=null)=>{if(!t||!(e in t.dataset))return r;const i=parseFloat(t.dataset[e]||"");return isNaN(i)?r:i};let y;const C=new Uint8Array(16);function R(){if(!y&&(y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(C)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function T(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}const E={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function O(t,e,r){if(E.randomUUID&&!e&&!t)return E.randomUUID();t=t||{};const i=t.random||(t.rng||R)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){r=r||0;for(let s=0;s<16;++s)e[r+s]=i[s];return e}return T(i)}const V=()=>({root:null,ratio:h(document.body,"scrollFireRatio",50),debugThresholdView:document.body.dataset.scrollFireDebugThresholdView!==void 0,debugThresholdViewColor:"rgba(255, 0, 0, 0.5)",debugDummyElementView:document.body.dataset.scrollFireDebugDummyElementView!==void 0,debugDummyElementViewColor:"rgba(0, 0, 255, 0.5)"});class z{constructor(e,r,i,s={}){c(this,"target");c(this,"htmlElementList");c(this,"rootElement");c(this,"enterCallback");c(this,"leaveCallback");c(this,"options");c(this,"intersectionOption");c(this,"intersectionObserver");c(this,"resizeObserver");this.target=e,this.enterCallback=r,this.leaveCallback=i,this.options={...V(),...s},this.rootElement=this.options.root||document.body,this.intersectionOption={threshold:[0,.5,1],root:this.options.root,rootMargin:`0px 0px -${100-this.options.ratio}% 0px`},this.htmlElementList=(()=>l(this.target)?this.target.toArray():m(this.target)?Array.from(this.target):[this.target])(),this.prepareDummyElement(),this.intersectionObserver=this.prepareIntersectionObserverInstance(),this.resizeObserver=this.prepareResizeOvserverInstance(),this.prepareDebugView()}prepareDummyElement(){this.htmlElementList.forEach(e=>{const r=this.createDummyElement(e);this.rootElement.appendChild(r)})}createDummyElement(e){const r=O(),i=document.createElement("span");return i.dataset.scrollFireDummy=r,e.dataset.scrollFireTarget=r,this.options.debugDummyElementView&&(i.dataset.scrollFireDummyView="is-acitve",i.style.borderTopColor=this.options.debugDummyElementViewColor),i}resetDummyElementPosition(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);if(!r)return;r.style.top="0px";const i=this.adjustedBoundingRect(r),s=this.adjustedBoundingRect(e);r.style.top=`${s.top-i.top}px`})}prepareIntersectionObserverInstance(){const e=l(this.target);return new IntersectionObserver(r=>{const i=this.getThresholdTop(this.options.ratio);r.map(s=>{const n=s.target,a=this.rootElement.querySelector(`[data-scroll-fire-target="${n.dataset.scrollFireDummy}"]`);a&&(s.isIntersecting||s.boundingClientRect.bottom<=i?typeof this.enterCallback=="function"&&this.enterCallback(e?jQuery(a):a):!s.isIntersecting&&s.boundingClientRect.bottom>i&&typeof this.leaveCallback=="function"&&this.leaveCallback(e?jQuery(a):a))})},this.intersectionOption)}prepareResizeOvserverInstance(){return new ResizeObserver(()=>{this.resetDummyElementPosition()})}prepareDebugView(){if(!this.options.debugThresholdView)return;const e=document.createElement("span");e.dataset.scrollFireThresholdDemo="is-acitve",e.style.top=`${this.options.ratio}%`,e.style.borderTopColor=this.options.debugThresholdViewColor,document.body.appendChild(e)}observe(){this.htmlElementList.forEach(e=>{const r=this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`);r&&(this.intersectionObserver.observe(r),this.resizeObserver.observe(r))})}unobserve(){this.htmlElementList.forEach(e=>{this.rootElement.querySelector(`[data-scroll-fire-dummy="${e.dataset.scrollFireTarget}"]`)&&(this.intersectionObserver.unobserve(e),this.resizeObserver.unobserve(e))})}getThresholdTop(e){return window.innerHeight*(e/100)}adjustedBoundingRect(e){var r=e.getBoundingClientRect(),i=getComputedStyle(e),s=i.transform;if(s){var n,a,p,g;if(s.startsWith("matrix3d(")){var d=s.slice(9,-1).split(/, /);n=+d[0],a=+d[5],p=+d[12],g=+d[13]}else if(s.startsWith("matrix(")){var d=s.slice(7,-1).split(/, /);n=+d[0],a=+d[3],p=+d[4],g=+d[5]}else return r;var v=i.transformOrigin,b=r.x-p-(1-n)*parseFloat(v),f=r.y-g-(1-a)*parseFloat(v.slice(v.indexOf(" ")+1)),D=n?r.width/n:e.offsetWidth,F=a?r.height/a:e.offsetHeight;return{x:b,y:f,width:D,height:F,top:f,right:b+D,bottom:f+F,left:b}}else return r}}const L=new CustomEvent("scrollFireResizeEvent");class w{constructor(){c(this,"trigger",[]);c(this,"_flag",!1);c(this,"_listner",this.onResize.bind(this))}start(){return this._flag?this:(this._flag=!0,this.observe(),this)}stop(){return this._flag?(this._flag=!1,this.unobserve(),this):this}addTrigger(e,r,i,s={}){return this.trigger.push(new z(e,r,i,s)),this}observe(){this.trigger.forEach(e=>e.observe()),window.addEventListener("resize",this._listner),window.addEventListener("load",this._listner),window.addEventListener("scrollFireResizeEvent",this._listner),this._listner()}unobserve(){this.trigger.forEach(e=>e.unobserve()),window.removeEventListener("resize",this._listner),window.removeEventListener("load",this._listner),window.removeEventListener("scrollFireResizeEvent",this._listner)}onResize(){this.trigger.forEach(e=>e.resetDummyElementPosition())}static forceResize(){window.dispatchEvent(L)}}return window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("[data-scroll-fire]");if(!t.length)return;const e=h(document.body,"scrollFireDelay"),r=h(document.body,"scrollFireDuration"),i=h(document.body,"scrollFireScale"),s=document.body.dataset.scrollFireDistance||null;t.forEach(n=>{const a=h(n,"scrollFireDelay",e);a&&n.style.setProperty("--scroll-fire-delay",`${a}ms`);const p=h(n,"scrollFireDuration",r);p&&n.style.setProperty("--scroll-fire-duration",`${p}ms`);const g=n.dataset.scrollFireDistance||s;g&&n.style.setProperty("--scroll-fire-distance",g);const d=h(n,"scrollFireScale",i);d&&n.style.setProperty("--scroll-fire-scale",d.toString())}),new w().addTrigger(t,n=>{if(n)return n.dataset.scrollFireAnimate="active"},n=>{if(!(document.body.dataset&&"scrollFireNotReverse"in document.body.dataset||n&&"scrollFireNotReverse"in n.dataset))return delete n.dataset.scrollFireAnimate},{}).start()}),w});
